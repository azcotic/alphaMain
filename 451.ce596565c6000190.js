"use strict";(self.webpackChunkModernize=self.webpackChunkModernize||[]).push([[451],{9451:(w,u,a)=>{a.r(u),a.d(u,{ReportsRoutes:()=>D});var p=a(4006),n=a(9417),m=a(8834),f=a(2102),h=a(9631),g=a(5084),R=a(3),t=a(4438);let k=(()=>{class i{constructor(r,o,e){this.fb=r,this.dialogRef=o,this.data=e,this.form=this.fb.group({startDate:[null,n.k0.required],endDate:[null,n.k0.required],reportName:[this.data.report?.name||"",n.k0.required],key:[""],typeReport:[this.data.report?.type||"",n.k0.required]})}onGenerate(){this.form.valid&&this.dialogRef.close(this.form.value)}onCancel(){this.dialogRef.close()}static{this.\u0275fac=function(o){return new(o||i)(t.rXU(n.ok),t.rXU(p.CP),t.rXU(p.Vh))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-report-date-range-dialog"]],features:[t.Jv_([(0,R.aw)()])],decls:30,vars:7,consts:[["picker1",""],["picker2",""],["mat-dialog-title",""],[1,"date-range-form",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","reportName","placeholder","Ej: Ventas, Inventario, etc"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],["matInput","","formControlName","key","placeholder","C\xf3digo del reporte o filtro"],[1,"actions"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(o,e){if(1&o){const c=t.RV6();t.j41(0,"h2",2),t.EFF(1),t.k0s(),t.j41(2,"form",3)(3,"mat-form-field",4)(4,"mat-label"),t.EFF(5,"Nombre del reporte"),t.k0s(),t.nrm(6,"input",5),t.k0s(),t.j41(7,"mat-form-field",4)(8,"mat-label"),t.EFF(9,"Fecha inicio"),t.k0s(),t.nrm(10,"input",6)(11,"mat-datepicker-toggle",7)(12,"mat-datepicker",null,0),t.k0s(),t.j41(14,"mat-form-field",4)(15,"mat-label"),t.EFF(16,"Fecha fin"),t.k0s(),t.nrm(17,"input",8)(18,"mat-datepicker-toggle",7)(19,"mat-datepicker",null,1),t.k0s(),t.j41(21,"mat-form-field",4)(22,"mat-label"),t.EFF(23,"C\xf3digo"),t.k0s(),t.nrm(24,"input",9),t.k0s(),t.j41(25,"div",10)(26,"button",11),t.bIt("click",function(){return t.eBV(c),t.Njj(e.onCancel())}),t.EFF(27,"Cancelar"),t.k0s(),t.j41(28,"button",12),t.bIt("click",function(){return t.eBV(c),t.Njj(e.onGenerate())}),t.EFF(29,"Generar"),t.k0s()()()}if(2&o){const c=t.sdS(13),l=t.sdS(20);t.R7$(),t.SpI("Generar Reporte: ",e.data.report.name,""),t.R7$(),t.Y8G("formGroup",e.form),t.R7$(8),t.Y8G("matDatepicker",c),t.R7$(),t.Y8G("for",c),t.R7$(6),t.Y8G("matDatepicker",l),t.R7$(),t.Y8G("for",l),t.R7$(10),t.Y8G("disabled",e.form.invalid)}},dependencies:[m.Hl,m.$z,p.hM,p.BI,f.RG,f.rl,f.nJ,f.yw,h.fS,h.fg,g.X6,g.Vh,g.bZ,g.bU,n.X1,n.qT,n.me,n.BC,n.cb,n.j4,n.JD],styles:[".mat-dialog-container[_ngcontent-%COMP%]{border-radius:16px!important;padding:20px!important;background:#f8f9fb!important;box-shadow:0 8px 32px #3c3c3c2e!important;min-width:400px;max-width:480px}.date-range-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;min-width:300px}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px}h2[mat-dialog-title][_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;margin-bottom:18px;color:#222}.mat-form-field[_ngcontent-%COMP%]{background:#fff;border-radius:8px}.mat-form-field-appearance-outline[_ngcontent-%COMP%]   .mat-form-field-outline[_ngcontent-%COMP%]{color:#bdbdbd}button[mat-button][_ngcontent-%COMP%], button[mat-raised-button][_ngcontent-%COMP%]{min-width:100px}  .mat-mdc-dialog-surface{border-radius:16px!important;padding:20px!important;background:#f8f9fb!important;box-shadow:0 8px 32px #3c3c3c2e!important;min-width:400px;max-width:480px}"]})}}return i})();var v=a(177),C=a(1438),x=a(7473);function y(i,F){if(1&i){const r=t.RV6();t.j41(0,"div",2)(1,"span",3),t.EFF(2),t.k0s(),t.j41(3,"button",4),t.bIt("click",function(){const e=t.eBV(r).$implicit,c=t.XpG();return t.Njj(c.openDateRangeDialog(e))}),t.EFF(4,"Generar"),t.k0s()()}if(2&i){const r=F.$implicit;t.R7$(2),t.JRh(r.name)}}const D=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"",children:[{path:"list",component:(()=>{class i{constructor(r,o,e){this.dialog=r,this.printerService=o,this.notificationService=e,this.reports=[{name:"Reporte Impresoras Seriales",type:"con-serial"},{name:"Reporte Impresoras NO Seriales",type:"sin-serial"}]}openDateRangeDialog(r){this.dialog.open(k,{data:{report:r},minWidth:"600px"}).afterClosed().subscribe(e=>{if(console.log(e),e&&e.startDate&&e.endDate&&e.reportName){const c=this.formatDate(e.startDate),l=this.formatDate(e.endDate);this.printerService.generateReport(c,l,e.key,e.typeReport).subscribe(s=>{if(1===s.code&&s.data&&s.fileName){const j=new Uint8Array(s.data.data),M=new Blob([j],{type:"application/octet-stream"}),S=s.fileName,d=document.createElement("a"),b=URL.createObjectURL(M);d.href=b,d.download=S,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(b),this.notificationService.showSuccess(s.message||"Reporte generado y descarga iniciada.")}else 1===s.code?(this.notificationService.showError("Respuesta del servidor inv\xe1lida para la descarga del reporte."),console.error("Invalid data for report download:",s)):this.notificationService.showError(s.message||"Error al generar el reporte")},s=>{this.notificationService.showError("Error de comunicaci\xf3n al generar el reporte."),console.error("Error subscribing to generateReport:",s)})}})}formatDate(r){if(!r)return"";const o=new Date(r),e=String(o.getDate()).padStart(2,"0");return`${String(o.getMonth()+1).padStart(2,"0")}/${e}/${o.getFullYear()}`}static{this.\u0275fac=function(o){return new(o||i)(t.rXU(p.bZ),t.rXU(C.k),t.rXU(x.J))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-reports"]],decls:2,vars:1,consts:[[1,"reports-list"],["class","report-row",4,"ngFor","ngForOf"],[1,"report-row"],[1,"report-name"],["mat-raised-button","","color","primary",3,"click"]],template:function(o,e){1&o&&(t.j41(0,"div",0),t.DNE(1,y,5,1,"div",1),t.k0s()),2&o&&(t.R7$(),t.Y8G("ngForOf",e.reports))},dependencies:[m.Hl,m.$z,p.hM,v.pM],styles:[".reports-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;max-width:500px;margin:32px auto}.report-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px;border:1px solid #e0e0e0;border-radius:8px;background:#fff}.report-name[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500}"]})}}return i})()}]}]}}]);